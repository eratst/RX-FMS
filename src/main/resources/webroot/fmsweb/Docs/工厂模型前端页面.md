# 工厂模型前端页面

该网页具体展示了工厂模型的数据结构，并且可以在该网页上实现简单的增删改查功能（不支持批量）。

网页使用了AngularJS (v1.6.7) 框架，目前仅实现了”查“的功能。增，删，改功能都没有做具体实现，部分增删改的界面已经完成。

网页中嵌入的地图由GIS组提供，用iframe嵌入在页面中。目前标注的点是hard coding在代码里，坐标在茂名石化厂区内，没有传参，因为数据库里还没有坐标数据。

网页中嵌入的三维模型是用三维组提供的模型文件，使用threeJS框架展示。进出场点暂时没有三维展示，侧线的模型之后需要进一步修改。如果你觉得罐的模型很丑，请跟三位组提意见。

### 图例说明

##### 组织机构树

![组织机构树](screenshot_begin.jpg)

+ 刚打开页面时出现左侧一级菜单，展示组织机构树。这里展示的组织机构按层级依次是：

  `总公司 -> 分公司 -> 工厂(办公点) -> 车间`

  车间下有区域，区域下分节点。每个区域下可能有的节点有对应字典表。

+ TODO#1：左侧一级菜单的的搜索栏目前还没有实现功能。

##### 组织机构详情页

![11组织机构详情页](screenshot_org_detail.jpg)

+ 点击某组织机构名称会展示其详细信息，点击其左侧展开按钮会展开下级组织。
+ 一直到车间级为止，信息加载是页面一打开就进行的，没有懒加载策略。
+ 右侧面板只有在第一次点击左侧菜单时才会出现，目前没有关闭右侧详情面板的功能。
+ 鼠标停留在左侧一级菜单上某一项时，会出现增，删，改的小图标。TODO#2：具体弹出框还没有做，目前仅有样式。

##### 区域详情

![节点详情](screenshot_area_detail.jpg)

+ 点击某节点名称右侧面板会更新右侧面板，显示该节点详细信息。
+ 车间级和区域级的下级内容，使用懒加载策略，在点击左侧展开按钮时才进行加载。
+ 已知BUG#1：区域第一次点击时，下级节点图标右上角的数字不会更新。（已经知道如何修复：工厂模型已开新接口，改接口即可修复）
+ TODO#3：区域详情页面里，区域类型目前是英文，需要匹配中文

##### 罐区详情

![罐区详情](screenshot_tank_detail.jpg)

+ 展开区域后点击节点列表的某一个，会出现二级菜单。图例中，点击“罐”，会出现罐列表。
  + 目前仅罐列表用了图标的形式展示，侧线和进出场点用普通列表展示。
  + 设备列表的加载是在左侧菜单展开时就已经完成了，**考虑要不要做懒加载**。
+ 度量指标会调用两个接口。先调取字典表中该设备下可能有的度量指标，如图中：温度，压力，液位。再调取具体有哪些度量指标，如图中温度和液位。可能有的但数据库中没有的，显示暂无该信息，并需要实现增加的功能
+ 已知BUG#2：第一次加载设备详细信息页面时，度量指标可能显示“暂无信息”。第二次点击某个罐时，度量指标可以显示。原因是该页面未加载前，度量指标的DOM还没加载完成，Angular没有进行数据绑定，AJAX获取数据完成之后，不能立即更新view中的数据。
+ TODO#4：度量指标未启用的卡片用灰色显示。
+ TODO#5：度量指标有增加的弹窗，但为实现功能。删除的按钮和功能也待做。
+ TODO#6：设备详情页面右上角修改基本信息的界面和具体实现待做。

### 已知Bug

| 序号   | BUG                                      |
| ---- | ---------------------------------------- |
| 1    | 区域第一次点击时，下级节点图标右上角的数字不会更新。（已经知道如何修复：工厂模型已开新接口，改接口即可修复） |
| 2    | 第一次加载设备详细信息页面时，度量指标可能显示“暂无信息”。（讲道理我应该修复了呀，还是麻烦再测测吧，极个别的时候会出现这个问题，不太容易重现，只有在页面彻底刷新之后才可能有此bug。） |
| 3    | 从进出场点的页面切回罐/侧线的页面是，三维模型加载有问题（device3DController元素不在页面里） |

### 待完成任务

| 序号   | TODO                                     | 优先级  |
| ---- | ---------------------------------------- | ---- |
| 1    | 左侧一级菜单的的搜索栏目前还没有实现功能。                    | 中    |
| 2    | 组织机构和区域的增删改，具体弹出框还没有做，目前仅有样式。            | 中    |
| 3    | 区域详情页面里，区域类型目前是英文，需要匹配中文                 | 低    |
| 4    | 度量指标未启用的卡片用灰色显示。                         | 低    |
| 5    | 度量指标有增加的弹窗，但为实现功能。删除的按钮和功能也待做。           | 低    |
| 6    | 设备详情页面右上角修改基本信息的界面和具体实现待做。               | 高    |
| 7    | 设备里只重做了罐，侧线，进出场点的详细信息的页面，需要增加其他页面。       | 高    |
| 8    | 某一些设备可能有（极少数）重复的度量指标，比如罐可能有两个温度指标。需要重写弹出框样式和逻辑 | 低    |

### 增删改功能

| 对象   |  增-界面   | 增-功能 | 改-界面 | 改-功能 | 删-界面 | 删-功能 |
| ---- | :-----: | :--: | :--: | :--: | :--: | :--: |
| 组织机构 |         |      |      |      |      |      |
| 区域   |         |      |      |      |      |      |
| 节点   |         |      |      |      |      |      |
| 度量指标 | &radic; |      |      |      |      |      |
| 设备列表 | &radic; |      |      |      |  部分  |      |

